<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2024a"><title>QMol_DFT_profiler</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(192, 76, 11); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S2 { margin: 20px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.CodeBlock { background-color: #F5F5F5; margin: 10px 15px 10px 0; display: inline-block }
.S3 { border-left: 0.555556px solid rgb(217, 217, 217); border-right: 0.555556px solid rgb(217, 217, 217); border-top: 0.555556px solid rgb(217, 217, 217); border-bottom: 0px none rgb(33, 33, 33); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S4 { border-left: 0.555556px solid rgb(217, 217, 217); border-right: 0.555556px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 0.555556px solid rgb(217, 217, 217); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S5 { margin: 10px 0px 20px; padding-left: 0px; font-family: Helvetica, Arial, sans-serif; font-size: 14px;  }
.S6 { margin-left: 56px; line-height: 21px; min-height: 0px; text-align: left; white-space: pre-wrap;  }
.S7 { border-left: 0.555556px solid rgb(217, 217, 217); border-right: 0.555556px solid rgb(217, 217, 217); border-top: 0.555556px solid rgb(217, 217, 217); border-bottom: 0.555556px solid rgb(217, 217, 217); border-radius: 4px; padding: 6px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S8 { margin: 15px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 17px; font-weight: 700; text-align: left;  }
.S9 { border-left: 0.555556px solid rgb(217, 217, 217); border-right: 0.555556px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S10 { margin: 10px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S11 { border-left: 0px none rgb(33, 33, 33); border-right: 0px none rgb(33, 33, 33); border-top: 0px none rgb(33, 33, 33); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 0px; line-height: 15.6px; min-height: 16px; white-space: pre; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px;  }
.S12 { margin: 10px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 15px; font-weight: 700; text-align: left;  }</style></head><body><div class = rtcContent><h1  class = 'S0'><span style=' font-family: monospace;'>QMol_DFT_profiler</span></h1><div  class = 'S1'><span>Memory and execution-time profiler for DFT models.</span></div><h2  class = 'S2'><span>Description</span></h2><div  class = 'S1'><span>Use </span><span style=' font-family: monospace;'>QMol_DFT_profiler</span><span> to estimate the memory footprint and execution time of a DFT model or component.</span></div><h2  class = 'S2'><span>Use</span></h2><div  class = 'S1'><span>Run the memory and execution-time profiling with either</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >QMol_DFT_profiler(QM);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >QMol_DFT_profiler(QM,</span><span style="color: #a709f5;">'all'</span><span >);</span></span></div></div></div><ul  class = 'S5'><li  class = 'S6'><span style=' font-family: monospace;'>QM</span><span> is any of a (TD)DFT model, external-functional, Hartree-functional, or exchange-correlation-functional objects.</span></li><li  class = 'S6'><span>The requirements and side effects as for both memory-only and execution-time-only modes detailed next.</span></li><li  class = 'S6'><span>Note that for TDDFT object only the memory footprint, and not the execution time, is estimated.</span></li></ul><div  class = 'S1'><span>Run only the memory profiling component with</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >QMol_DFT_profiler(QM,</span><span style="color: #a709f5;">'memory'</span><span >);</span></span></div></div></div><ul  class = 'S5'><li  class = 'S6'><span style=' font-style: italic;'>DFT model case:</span><span> If </span><span style=' font-family: monospace;'>QM</span><span> is a DFT model object (</span><a href = "./QMol_DFT_spinRes.html"><span style=' font-family: monospace;'>QMol_DFT_spinRes</span></a><span> or </span><a href = "./QMol_DFT_spinPol.html"><span style=' font-family: monospace;'>QMol_DFT_spinPol</span></a><span>), it should define a proper discretization domain (explicitly or implicitly), and external, Hartree, and exchange-correlation functionals; However, it does not need to be initialized before running the memory profiling. The memory profiling uses the object's </span><span style=' font-family: monospace;'>getMemoryProfile</span><span> method and has its side effects: all the DFT-model properties are left unchanged while run-time properties may be altered. Notably, if the object was not initialized (</span><span style=' font-family: monospace;'>isInitialized = false</span><span>), </span><span style=' font-family: monospace;'>getMemoryProfile</span><span> </span><span style=' font-family: monospace;'>reset</span><span>s the object.</span></li><li  class = 'S6'><span style=' font-style: italic;'>DFT component case:</span><span> If </span><span style=' font-family: monospace;'>QM</span><span> is an external, Hartree, or exchange-correlation functional object, it must be initialized (with a DFT component -- see the respective documentation pages for details).</span></li><li  class = 'S6'><span style=' font-style: italic;'>TDDFT propagator case:</span><span> if QM is a TDDFT propagator object, it should define a full DFT model, which is initialized before performing the memory profiling. </span></li><li  class = 'S6'><span>In all cases, not all the listed components may be used in actual simulations and the memory estimate tries to be conservative. On the other hand, it only includes the discretization of member components on the domain grid and ignores other (small) properties.</span></li></ul><div  class = 'S1'><span>Run only the execution-time profiling component with</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >QMol_DFT_profiler(QM,</span><span style="color: #a709f5;">'time'</span><span >);</span></span></div></div></div><ul  class = 'S5'><li  class = 'S6'><span style=' font-style: italic;'>DFT model case:</span><span> If </span><span style=' font-family: monospace;'>QM</span><span> is a DFT model object (</span><a href = "./QMol_DFT_spinRes.html"><span style=' font-family: monospace;'>QMol_DFT_spinRes</span></a><span> or </span><a href = "./QMol_DFT_spinPol.html"><span style=' font-family: monospace;'>QMol_DFT_spinPol</span></a><span>), it should define a proper discretization domain (explcitly or implicitly), and external, Hartree, and exchange-correlation functionals; However, it does not need to be initialized before running the memory profiling. The execution-time profiling initializes the object and returns it initialized.</span></li><li  class = 'S6'><span style=' font-style: italic;'>DFT component case:</span><span> If </span><span style=' font-family: monospace;'>QM</span><span> is an external, Hartree, or exchange-correlation functional object, it must be initialized (with a DFT component -- see the respective documentation pages for details). The execution-time profiling initialized the parent DFT component (</span><span style=' font-family: monospace;'>QM.DFT.initialize</span><span>).</span></li><li  class = 'S6'><span style=' font-style: italic;'>TDDFT propagator case:</span><span> no execution time profiling is available for TDDFT propagators. Run an actual TDDFT propagation (over a short time interval) to get an estimate.</span></li></ul><div  class = 'S1'><span>The execution-time profiling is performed by running each listed operation a certain number of times and retunrs the average elapsed time to do so. The default number of iterations is defined internally based on the dimension of the model. Overwrite this default values and specify the number of iterations </span><span style=' font-family: monospace;'>nbIter</span><span> with</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >QMol_DFT_profiler(QM,</span><span style="color: #a709f5;">'all'</span><span >,nbIter);     </span><span style="color: #008013;">% Both memory and time profiling</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >QMol_DFT_profiler(QM,</span><span style="color: #a709f5;">'time'</span><span >,nbIter);    </span><span style="color: #008013;">% Execution-time profiling only</span></span></div></div></div><h2  class = 'S2'><span>Examples</span></h2><h3  class = 'S8' id = 'H_9E118FF3' ><span>Spin-polarized DFT model</span></h3><div  class = 'S1'><span>Create a spin-polarized DFT model with</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: #008013;">% Domain</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >x   =   -200:.1:150;</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span style="color: #008013;">% Molecular model</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >A1  =   QMol_Va_softCoulomb(</span><span style="color: #a709f5;">'name'</span><span >,</span><span style="color: #a709f5;">'atom 1'</span><span >,</span><span style="color: #a709f5;">'charge'</span><span >,3,</span><span style="color: #a709f5;">'position'</span><span >,-3);</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >A2  =   QMol_Va_softCoulomb(</span><span style="color: #a709f5;">'name'</span><span >,</span><span style="color: #a709f5;">'atom 2'</span><span >,</span><span style="color: #a709f5;">'charge'</span><span >,3,</span><span style="color: #a709f5;">'position'</span><span >,0);</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >A3  =   QMol_Va_softCoulomb(</span><span style="color: #a709f5;">'name'</span><span >,</span><span style="color: #a709f5;">'atom 3'</span><span >,</span><span style="color: #a709f5;">'charge'</span><span >,3,</span><span style="color: #a709f5;">'position'</span><span >,2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span style="color: #008013;">% DFT model</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >Vext=   QMol_DFT_Vext(</span><span style="color: #a709f5;">'atom'</span><span >,{A1,A2});</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >Vh  =   QMol_DFT_Vh_conv;</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >Vxc =  {QMol_DFT_Vx_LDA_exp,QMol_DFT_Vx_XX_conv};</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >DFT =   QMol_DFT_spinPol(                           </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >            </span><span style="color: #a709f5;">'xspan'</span><span >,                        x,      </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >            </span><span style="color: #a709f5;">'occupation'</span><span >,                   {[1 1 1 1 1],[1 1 1 1]},</span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >            </span><span style="color: #a709f5;">'externalPotential'</span><span >,            Vext,   </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre"><span >            </span><span style="color: #a709f5;">'HartreePotential'</span><span >,             Vh,     </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >            </span><span style="color: #a709f5;">'exchangeCorrelationPotential'</span><span >, Vxc);</span></span></div></div></div><div  class = 'S10'><span>Run a full (memory + execution-time) profiling</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >QMol_DFT_profiler(DFT);</span></span></div></div></div><div  class = 'S10'><span>yielding</span></div><div class = 'preformatted-plain' style = 'margin: 10px 3px 10px 55px; padding: 10px 10px 10px 5px; '><div  class = 'S11'><span style="white-space: pre"><span >=== Memory footprint =====================================================</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  Components                                                    -- Size --</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Domain discretization                                        </span></span></div><div  class = 'S11'><span style="white-space: pre"><span >    &gt; domain                                                       27.4 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >    &gt; gradient                                                     54.7 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >    &gt; Laplacian                                                    27.4 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >    &gt; Laplacian (velocity gauge)                                   54.7 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Kohn-Sham orbitals                                           </span></span></div><div  class = 'S11'><span style="white-space: pre"><span >    &gt; spin up                                                     273.5 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >    &gt; spin down                                                   218.8 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * One-body density                                             </span></span></div><div  class = 'S11'><span style="white-space: pre"><span >    &gt; density                                                      54.7 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >    &gt; gradient                                                     54.7 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Kohn-Sham potential                                            54.7 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Kohn-Sham potential gradient                                   54.7 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * External functional                                          </span></span></div><div  class = 'S11'><span style="white-space: pre"><span >    &gt; potential                                                    27.4 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >    &gt; potential gradient                                           27.4 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Hartree functional                                             54.7 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Exchange functional (LDA exponential)                        </span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Exact-exchange functional (conv.)                            </span></span></div><div  class = 'S11'><span style="white-space: pre"><span >    &gt; interaction potential                                        54.7 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >    &gt; spin up kernel                                              273.5 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >    &gt; spin down kernel                                            218.8 KB</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >                                                                ----------</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >                                                        TOTAL =     1.5 MB</span></span></div><div  class = 'S11'>&nbsp;</div><div  class = 'S11'><span style="white-space: pre"><span >=== Execution time =======================================================</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  Operator components                                           -- Time --</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Hamiltonian (spin up)                        5 x 2.50e-03 = 1.25e-02 s</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Hamiltonian (spin down)                      4 x 2.08e-03 = 8.31e-03 s</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >                                                                ----------</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >                                                        TOTAL = 2.08e-02 s</span></span></div><div  class = 'S11'>&nbsp;</div><div  class = 'S11'><span style="white-space: pre"><span >  * Kinetic                                      9 x 2.22e-04 = 2.00e-03 s</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Potential (spin up)                          5 x 2.07e-03 = 1.04e-02 s</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Potential (spin down)                        4 x 1.68e-03 = 6.72e-03 s</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >                                                                ----------</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >                                                        TOTAL = 1.91e-02 s</span></span></div><div  class = 'S11'>&nbsp;</div><div  class = 'S11'><span style="white-space: pre"><span >  * External potential                           9 x 2.02e-05 = 1.82e-04 s</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Hartree potential                            9 x 2.11e-05 = 1.90e-04 s</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Exch.-corr. potential #1 (spin up)           5 x 1.94e-05 = 9.72e-05 s</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Exch.-corr. potential #1 (spin down)         4 x 1.98e-05 = 7.90e-05 s</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Exch.-corr. potential #2 (spin up)           5 x 2.50e-03 = 1.25e-02 s</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Exch.-corr. potential #2 (spin down)         4 x 2.43e-03 = 9.71e-03 s</span></span></div><div  class = 'S11'>&nbsp;</div><div  class = 'S11'><span style="white-space: pre"><span >  Building potential components                                 -- Time --</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * One-body density                                            3.15e-04 s</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * External functional                                         1.94e-05 s</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Hartree functional                                          3.66e-04 s</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Exchange-correlation functional #1                          6.59e-05 s</span></span></div><div  class = 'S11'><span style="white-space: pre"><span >  * Exchange-correlation functional #2                          4.12e-05 s</span></span></div><div  class = 'S11'>&nbsp;</div><div  class = 'S11'><span style="white-space: pre"><span >  (average times over 500 iterations)</span></span></div><div  class = 'S11'>&nbsp;</div><div  class = 'S11'><span style="white-space: pre"><span >##########################################################################</span></span></div></div><div  class = 'S1'><span>As one may expect, the exact-exchange potential (second exchange-correlation functional) is much slower to compute than the other operators. </span></div><h2  class = 'S2'><span>Test suite</span></h2><div  class = 'S1'><span>Run the test suite for the class in normal or </span><a href = "./Test_suite.html"><span>summary mode</span></a><span> respectively with</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >QMol_test.test(</span><span style="color: #a709f5;">'DFT_profiler'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >QMol_test.test(</span><span style="color: #a709f5;">'-summary'</span><span >,</span><span style="color: #a709f5;">'DFT_profiler'</span><span >);</span></span></div></div></div><div  class = 'S10'><span>See </span><a href = "./QMol_test,html"><span style=' font-family: monospace;'>QMol_test</span></a><span> for details regarding how to create a test suite for new classes.</span></div><h2  class = 'S2'><span>For developers</span></h2><div  class = 'S1'><span style=' font-family: monospace;'>QMol_DFT_profiler</span><span> hard-codes the size of double-precision floats, which seem to be fixed to 8-bits per MATLAB documentation. If this comes to change, the values need be updated in the </span><span style=' font-family: monospace;'>getMemoryFootprint</span><span> method.</span></div><h3  class = 'S8'><span>Other class methods</span></h3><div  class = 'S1'><span>The </span><span style=' font-family: monospace;'>QMol_DFT_profiler</span><span> class also defines the following static methods restricted to QMol-grid classes (</span><span style=' font-family: monospace;'>Access=?QMol_suite</span><span>)</span></div><h4  class = 'S12'><span style=' font-family: monospace;'>getMemoryFootprint</span></h4><div  class = 'S1'><span>Get the memory footprint of an array with N elements with</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >m = QMol_DFT_profiler.getMemoryFootprint(N,</span><span style="color: #a709f5;">'real'</span><span >);   </span><span style="color: #008013;">% Real-valued array</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >m = QMol_DFT_profiler.getMemoryFootprint(N,</span><span style="color: #a709f5;">'imag'</span><span >);   </span><span style="color: #008013;">% Complex array</span></span></div></div></div><ul  class = 'S5'><li  class = 'S6'><span>The output m is in bytes</span></li></ul><h4  class = 'S12'><span style=' font-family: monospace;'>showMemoryFootprint</span></h4><div  class = 'S1'><span>Print out the estimated memory footprint of a component with</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >QMol_DFT_profiler.showMemoryFootprint(msg,mem,lvl)</span></span></div></div></div><ul  class = 'S5'><li  class = 'S6'><span style=' font-family: monospace;'>msg</span><span> is a character array with the description of the component being displayed (see </span><a href = "#M_0CCA27CF"><span>example above</span></a><span>).</span></li><li  class = 'S6'><span style=' font-family: monospace;'>mem</span><span> is the estimated memory footprint for the component, </span><span style=' text-decoration: underline;'>in bytes</span><span>. The value will automatically be converted to KB, MB, GB, or TB as needed. If </span><span style=' font-family: monospace;'>mem</span><span> is </span><span style=' font-family: monospace;'>0</span><span>, </span><span style=' font-family: monospace;'>NaN</span><span>, or </span><span style=' font-family: monospace;'>Inf</span><span>, no memory values is printed out (just the message, see </span><a href = "#M_0CCA27CF"><span>example above</span></a><span>).</span></li><li  class = 'S6'><span style=' font-family: monospace;'>lvl = 1</span><span> or </span><span style=' font-family: monospace;'>lvl = 2</span><span>, specifies the indentation level for the component (see </span><a href = "#M_0CCA27CF"><span>example above</span></a><span>). If no level is specified, default </span><span style=' font-family: monospace;'>lvl = 1</span><span> is used.</span></li></ul><h2  class = 'S2'><span>Notes</span></h2><div  class = 'S1'><span>The results displayed in this documentation page were generated using version 01.21 of the QMol-grid package.</span></div><ul  class = 'S5'><li  class = 'S6'><span style=' font-family: monospace;'>QMol_DFT_profiler</span><span> was intorduced in version 01.10</span></li></ul>
<br>
<!-- 
##### SOURCE BEGIN #####
%% |QMol_DFT_profiler|
% Memory and execution-time profiler for DFT models.
%% Description
% Use |QMol_DFT_profiler| to estimate the memory footprint and execution time 
% of a DFT model or component.
%% Use
% Run the memory and execution-time profiling with either

QMol_DFT_profiler(QM);
QMol_DFT_profiler(QM,'all');
%% 
% * |QM| is any of a (TD)DFT model, external-functional, Hartree-functional, 
% or exchange-correlation-functional objects.
% * The requirements and side effects as for both memory-only and execution-time-only 
% modes detailed next.
% * Note that for TDDFT object only the memory footprint, and not the execution 
% time, is estimated.
%% 
% Run only the memory profiling component with

QMol_DFT_profiler(QM,'memory');
%% 
% * _DFT model case:_ If |QM| is a DFT model object (<./QMol_DFT_spinRes.html 
% |QMol_DFT_spinRes|> or <./QMol_DFT_spinPol.html |QMol_DFT_spinPol|>), it should 
% define a proper discretization domain (explicitly or implicitly), and external, 
% Hartree, and exchange-correlation functionals; However, it does not need to 
% be initialized before running the memory profiling. The memory profiling uses 
% the object's |getMemoryProfile| method and has its side effects: all the DFT-model 
% properties are left unchanged while run-time properties may be altered. Notably, 
% if the object was not initialized (|isInitialized = false|), |getMemoryProfile| 
% |reset|s the object.
% * _DFT component case:_ If |QM| is an external, Hartree, or exchange-correlation 
% functional object, it must be initialized (with a DFT component REPLACE_WITH_DASH_DASH see the respective 
% documentation pages for details).
% * _TDDFT propagator case:_ if QM is a TDDFT propagator object, it should define 
% a full DFT model, which is initialized before performing the memory profiling. 
% * In all cases, not all the listed components may be used in actual simulations 
% and the memory estimate tries to be conservative. On the other hand, it only 
% includes the discretization of member components on the domain grid and ignores 
% other (small) properties.
%% 
% Run only the execution-time profiling component with

QMol_DFT_profiler(QM,'time');
%% 
% * _DFT model case:_ If |QM| is a DFT model object (<./QMol_DFT_spinRes.html 
% |QMol_DFT_spinRes|> or <./QMol_DFT_spinPol.html |QMol_DFT_spinPol|>), it should 
% define a proper discretization domain (explcitly or implicitly), and external, 
% Hartree, and exchange-correlation functionals; However, it does not need to 
% be initialized before running the memory profiling. The execution-time profiling 
% initializes the object and returns it initialized.
% * _DFT component case:_ If |QM| is an external, Hartree, or exchange-correlation 
% functional object, it must be initialized (with a DFT component REPLACE_WITH_DASH_DASH see the respective 
% documentation pages for details). The execution-time profiling initialized the 
% parent DFT component (|QM.DFT.initialize|).
% * _TDDFT propagator case:_ no execution time profiling is available for TDDFT 
% propagators. Run an actual TDDFT propagation (over a short time interval) to 
% get an estimate.
%% 
% The execution-time profiling is performed by running each listed operation 
% a certain number of times and retunrs the average elapsed time to do so. The 
% default number of iterations is defined internally based on the dimension of 
% the model. Overwrite this default values and specify the number of iterations 
% |nbIter| with

QMol_DFT_profiler(QM,'all',nbIter);     % Both memory and time profiling
QMol_DFT_profiler(QM,'time',nbIter);    % Execution-time profiling only
%% Examples
% Spin-polarized DFT model
% Create a spin-polarized DFT model with

% Domain
x   =   -200:.1:150;

% Molecular model
A1  =   QMol_Va_softCoulomb('name','atom 1','charge',3,'position',-3);
A2  =   QMol_Va_softCoulomb('name','atom 2','charge',3,'position',0);
A3  =   QMol_Va_softCoulomb('name','atom 3','charge',3,'position',2);

% DFT model
Vext=   QMol_DFT_Vext('atom',{A1,A2});
Vh  =   QMol_DFT_Vh_conv;
Vxc =  {QMol_DFT_Vx_LDA_exp,QMol_DFT_Vx_XX_conv};

DFT =   QMol_DFT_spinPol(                           ...
            'xspan',                        x,      ...
            'occupation',                   {[1 1 1 1 1],[1 1 1 1]},...
            'externalPotential',            Vext,   ...
            'HartreePotential',             Vh,     ...
            'exchangeCorrelationPotential', Vxc);
%% 
% Run a full (memory + execution-time) profiling

QMol_DFT_profiler(DFT);
%% 
% yielding
%%
% 
%  === Memory footprint =====================================================
%    Components                                                    REPLACE_WITH_DASH_DASH Size REPLACE_WITH_DASH_DASH
%    * Domain discretization                                        
%      > domain                                                       27.4 KB
%      > gradient                                                     54.7 KB
%      > Laplacian                                                    27.4 KB
%      > Laplacian (velocity gauge)                                   54.7 KB
%    * Kohn-Sham orbitals                                           
%      > spin up                                                     273.5 KB
%      > spin down                                                   218.8 KB
%    * One-body density                                             
%      > density                                                      54.7 KB
%      > gradient                                                     54.7 KB
%    * Kohn-Sham potential                                            54.7 KB
%    * Kohn-Sham potential gradient                                   54.7 KB
%    * External functional                                          
%      > potential                                                    27.4 KB
%      > potential gradient                                           27.4 KB
%    * Hartree functional                                             54.7 KB
%    * Exchange functional (LDA exponential)                        
%    * Exact-exchange functional (conv.)                            
%      > interaction potential                                        54.7 KB
%      > spin up kernel                                              273.5 KB
%      > spin down kernel                                            218.8 KB
%                                                                  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%                                                          TOTAL =     1.5 MB
%  
%  === Execution time =======================================================
%    Operator components                                           REPLACE_WITH_DASH_DASH Time REPLACE_WITH_DASH_DASH
%    * Hamiltonian (spin up)                        5 x 2.50e-03 = 1.25e-02 s
%    * Hamiltonian (spin down)                      4 x 2.08e-03 = 8.31e-03 s
%                                                                  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%                                                          TOTAL = 2.08e-02 s
%  
%    * Kinetic                                      9 x 2.22e-04 = 2.00e-03 s
%    * Potential (spin up)                          5 x 2.07e-03 = 1.04e-02 s
%    * Potential (spin down)                        4 x 1.68e-03 = 6.72e-03 s
%                                                                  REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%                                                          TOTAL = 1.91e-02 s
%  
%    * External potential                           9 x 2.02e-05 = 1.82e-04 s
%    * Hartree potential                            9 x 2.11e-05 = 1.90e-04 s
%    * Exch.-corr. potential #1 (spin up)           5 x 1.94e-05 = 9.72e-05 s
%    * Exch.-corr. potential #1 (spin down)         4 x 1.98e-05 = 7.90e-05 s
%    * Exch.-corr. potential #2 (spin up)           5 x 2.50e-03 = 1.25e-02 s
%    * Exch.-corr. potential #2 (spin down)         4 x 2.43e-03 = 9.71e-03 s
%  
%    Building potential components                                 REPLACE_WITH_DASH_DASH Time REPLACE_WITH_DASH_DASH
%    * One-body density                                            3.15e-04 s
%    * External functional                                         1.94e-05 s
%    * Hartree functional                                          3.66e-04 s
%    * Exchange-correlation functional #1                          6.59e-05 s
%    * Exchange-correlation functional #2                          4.12e-05 s
%  
%    (average times over 500 iterations)
%  
%  ##########################################################################
%
%% 
% As one may expect, the exact-exchange potential (second exchange-correlation 
% functional) is much slower to compute than the other operators. 
%% Test suite
% Run the test suite for the class in normal or <./Test_suite.html summary mode> 
% respectively with

QMol_test.test('DFT_profiler');
QMol_test.test('-summary','DFT_profiler');
%% 
% See <./QMol_test,html |QMol_test|> for details regarding how to create a test 
% suite for new classes.
%% For developers
% |QMol_DFT_profiler| hard-codes the size of double-precision floats, which 
% seem to be fixed to 8-bits per MATLAB documentation. If this comes to change, 
% the values need be updated in the |getMemoryFootprint| method.
% Other class methods
% The |QMol_DFT_profiler| class also defines the following static methods restricted 
% to QMol-grid classes (|Access=?QMol_suite|)
% |getMemoryFootprint|
% Get the memory footprint of an array with N elements with

m = QMol_DFT_profiler.getMemoryFootprint(N,'real');   % Real-valued array
m = QMol_DFT_profiler.getMemoryFootprint(N,'imag');   % Complex array
%% 
% * The output m is in bytes
% |showMemoryFootprint|
% Print out the estimated memory footprint of a component with

QMol_DFT_profiler.showMemoryFootprint(msg,mem,lvl)
%% 
% * |msg| is a character array with the description of the component being displayed 
% (see example above).
% * |mem| is the estimated memory footprint for the component, in bytes. The 
% value will automatically be converted to KB, MB, GB, or TB as needed. If |mem| 
% is |0|, |NaN|, or |Inf|, no memory values is printed out (just the message, 
% see example above).
% * |lvl = 1| or |lvl = 2|, specifies the indentation level for the component 
% (see example above). If no level is specified, default |lvl = 1| is used.
%% Notes
% The results displayed in this documentation page were generated using version 
% 01.21 of the QMol-grid package.
%% 
% * |QMol_DFT_profiler| was intorduced in version 01.10
##### SOURCE END #####
-->
</div></body></html>